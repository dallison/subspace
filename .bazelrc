build:asan --strip=never
build:asan --copt -fsanitize=address
build:asan --copt -DADDRESS_SANITIZER
build:asan --copt -g
build:asan --copt -fno-omit-frame-pointer
build:asan --linkopt -fsanitize=address

# Enable the built-in platform-specific configuration feature
common --enable_platform_specific_config

# Apply this flag only when building on/for macOS
build:macos --macos_minimum_os=10.15

# For all builds, use C++17
build --cxxopt="-std=c++17"
build --cxxopt='-Wno-sign-compare'

# For Apple Silicon
build:apple_silicon --cpu=darwin_arm64

# Common flags for Clang
build:clang --action_env=BAZEL_COMPILER=clang
build:clang --action_env=CC=clang --action_env=CXX=clang++
build:clang --copt="-Wno-reserved-macro-identifier"
build:clang --copt="-Wunused-parameter"

#build:clang --linkopt=-fuse-ld=lld

# Clang with libc++
build:libc++ --config=clang
build:libc++ --action_env=CXXFLAGS=-stdlib=libc++
build:libc++ --action_env=LDFLAGS=-stdlib=libc++
build:libc++ --action_env=BAZEL_CXXOPTS=-stdlib=libc++
build:libc++ --action_env=BAZEL_LINKLIBS=-l%:libc++.a:-l%:libc++abi.a
build:libc++ --action_env=BAZEL_LINKOPTS=-lm:-pthread
build:libc++ --define force_libcpp=enabled

# Define the QNX environment
# Force Bazel to stop looking at the local host compiler
build:qnx --crosstool_top=//toolchain:qnx_toolchain
build:qnx --cpu=aarch64
build:qnx --compiler=qcc

# This is the key: prevent auto-configuration
build:qnx --repo_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1

build:qnx --action_env=QNX_HOST=$(HOME)/qnx800/host/linux/x86_64
build:qnx --action_env=QNX_TARGET=$(HOME)/qnx800/target/qnx8
build:qnx --crosstool_top=//toolchain:qnx_toolchain
build:qnx --cpu=aarch64
build:qnx --host_crosstool_top=@bazel_tools//tools/cpp:toolchain
